RICIAN DENOISING DIFFUSION PROBABILISTIC
MODELS FOR SODIUM BREAST MRI ENHANCEMENT
Shuaiyu Yuan1*, Tristan Whitmarsh1 , Dimitri A Kessler1,2, Otso Arponen1, Mary A McLean1,
Gabrielle Baxter1, Frank Riemer3, Aneurin J Kennerley4,5, William J Brackenbury4,
Fiona J Gilbert1 and Joshua D Kaggie1*
1University of Cambridge, 2Universitat de Barcelona, 3Haukeland University Hospital,
4University of York, 5Manchester Metropolitan University
*{sy442, jk636}@cam.ac.uk
ABSTRACT
Sodium MRI is an imaging technique used to visualize and quantify sodium concentrations in vivo,
playing a role in many biological processes and potentially aiding in breast cancer characterization.
Sodium MRI, however, suffers from inherently low signal-to-noise ratios (SNR) and spatial resolu-
tion, compared with conventional proton MRI. A deep learning method, the Denoising Diffusion
Probabilistic Models (DDPM), has demonstrated success across a wide range of denoising tasks, yet
struggles with sodium MRI’s unique noise profile, as DDPM primarily targets Gaussian noise. DDPM
can distort features when applied to sodium MRI. This paper advances the DDPM by introducing the
Rician DDPM (RDDPM) for sodium MRI denoising. RDDPM converts Rician noise to Gaussian
noise at each timestep during the denoising process. The model’s performance is evaluated using three
no-reference image quality assessment metrics, where RDDPM consistently outperforms DDPM and
other CNN-based denoising methods.
Keywords Denoising Diffusion Probabilistic Models · Image Denoising · Sodium MRI
1
Introduction
Magnetic Resonance Imaging (MRI) is a widely used, non invasive, and radiation-free medical imaging technique for
disease diagnosis. While MRI is mainly used for identifying disease locations, it can also be used for determining
molecular and metabolic information without the need for an invasive biopsy through imaging techniques such as
sodium MRI [1, 2]. Sodium MRI differs from conventional proton MRI, due to its inherent challenges of lower
signal-to-noise ratios (SNR) and spatial resolution. These differences are caused by sodium’s lower concentration in the
body and its lower gyromagnetic ratio compared to proton, affecting signal reception quality [3]. Deep learning (DL)
denoising methods hold a significant potential to enhance sodium MRI image quality and offer new possibilities for
clinical application, such as diseases characterization in breast cancer.
In recent years, generative models, represented by Denoising Diffusion Probabilistic Models (DDPM) [4], have been
recognized as a powerful algorithm for enhancing medical image quality. The application of DDPM in medical image
denoising has been studied through multiple modalities, demonstrating its versatility and effectiveness. For example,
Gong et al. [5] employed the DDPM to denoise low-dose PET images, achieving better performance than other DL
denoising methods. In the realm of MRI, Chung et al. [6] developed a regularized diffusion model to denoise and
super-resolve knee and liver MR images, achieving state-of the-art results. Xiang et al. [7] proposed a self-supervised
diffusion model to denoise diffusion-weighted MRIs and demonstrated superior denoising performance.
Although the standard DDPM, as well as its variants, have achieved great success in denoising tasks across diverse
imaging modalities, applying them to sodium MRI is challenging. A key characteristic of MRI is that its signals arise
from complex data, which has Rician noise, especially at low SNR with magnitude-only data. In DDPM, however, there
is a mismatch between the Gaussian noises assumed by the model, and the actual Rician noises present in MRI data.
Directly applying DDPM to sodium MRI data may not adequately capture these non-Gaussian noise characteristics,
arXiv:2410.11511v1  [eess.IV]  15 Oct 2024
Figure 1: The pipeline of proposed RDDPM. (a) aims to convert the image with Rician noise to Gaussian noise at each
timestep. (b) is a pre-trained DDPM.
potentially resulting in artifacts or distortions in the denoised images. Additionally, sodium MRI lacks high-quality
reference images and large datasets, both of which are commonly expected for training diffusion models effectively.
This work proposes a Rician DDPM (RDDPM) to address these limitations, which converts the Rician noise to Gaussian
noise at each timestep of the DDPM denoising process. To train the RDDPM, we first train a convolutional neural
network (CNN) model to denoise sodium MR images; the denoised images are then used to train the RDDPM.
2
Method
2.1
Sodium MRI Denoising with CNN
To denoise the sodium MR images with CNN models, such as Unet [8], synthetic sodium MR images are created, which
are formed by introducing sodium noise into T1-weighted (T1w) MR images [9] using the following equation,
R =
s
S + N
√
2
2
+
 N
√
2
2
Where R is the synthetic sodium MR image, S is the T1w MR image and N is the sodium noise, which is the slices of
the original sodium MRI data where there is no signal contained. The CNN models are then trained with pairs of T1w
MR images and synthetic sodium MR images.
2.2
DDPM
A DDPM is a generative model that learns to generate data by reversing a diffusion process. A DDPM is composed of
two main stages: the forward (diffusion) process and the reverse (denoising) process [4]. The forward process involves
gradually adding noise to a data sample x0over T timesteps to generate noisy samples x1, x2,. . . , xT . This process can
be defined as:
q(xt|xt−1) = N

xt;
p
1 −βtxt−1, βtI

where βt is a variance schedule that controls the amount of noise added at each timestep and N(.) denotes a Gaussian
distribution. An alternative formulation directly computes a noisy sample xt at any timestep t in a single step:
xt = √¯αtx0 +
√
1 −¯αtϵ
where αt = 1 −βt, ¯αt is the cumulative product of noise terms up to time t and ϵ = N(0, 1). The reverse process
aims to recover the original data by learning to gradually remove noise from xt back to x0. The reverse steps are
parameterized by a neural network ϵθ, which predicts the distribution of xt−1 given xt. This process is defined as:
xt−1 =
1
√¯αt

xt −1 −αt
√1 −¯αt
ϵθ

+ σtϵ
where σt is the standard deviation of added noise.
2
2.3
Sodium MRI Denoising with RDDPM
Unlike the Gaussian noise in the DDPM, which is zero mean and has the closure property, simply replacing the Gaussian
noise in the DDPM with a Rician noise can collapse the model. In RDDPM, we use two parallel DDPM models. The
pseudocode of the denoising procedure of RDDPM is shown in Algorithm 1 below.
Algorithm 1 RDDPM denoising procedure
Require: Magnitude of noisy image At, start timestep T0, a pre-trained DDPM model i
1: for t = T0, . . . , 1 do
2:
zi ∼N(0, I)
3:
zj ∼N(0, I)
4:
ˆx2
t = θ(A2
t, t)
5:
ˆϵt = modeli( ˆxt, t)
6:
xt−1 =
1
√¯
αt ( ˆxt −
1−αt
√1−¯
αt ˆϵt)
7:
if t ̸= 1 then
8:
xt = xt−1 + σtzi
9:
At−1 =
q
x2
t−1 + (σtzj)2
10:
end if
11: end for
12: return x0
The input to the model is a noisy MRI magnitude image, At, where T0 is the starting timestep of the reverse process.
For each timestep t, a model, θ, predicts the squared Gaussian-noise image, x2
t, from the squared Rician-noise image,
A2
t. Afterwards, a pre-trained DDPM model, modeli, is employed to perform the denoising process, whose weights are
frozen. For timesteps t ̸= 1, two sets of noise variables, zi and zj, drawn from a standard normal distribution N(0, 1),
are added to the denoised image maintaining stochasticity and modeling the Rician noise characteristics. The denoising
process proceeds iteratively until the final timestep t = 0, at which point the denoised image x0 is returned as the
output.
As shown in Fig 1, the denoising process is visually represented through the progressive refinement of noisy MRI
data over time. The leftmost image corresponds to the input noisy sodium MRI data, AT0, while the rightmost image
represents the final denoised sodium MR image x0. Each intermediate step shows the image after the application of
noise transform and denoising process at the corresponding timestep, reflecting the gradual noise removal.
The training procedure of RDDPM is also different from that of DDPM. The pseudocode of the training procedure of
RDDPM is shown in Algorithm 2 below.
Algorithm 2 RDDPM training procedure
Require: Dataset d, maximum diffusion length Tm, inner epoch number pi
1: repeat
2:
x0 ∼d(x0)
3:
t ∼U({1, . . . , Tm})
4:
ϵj ∼N(0, I)
5:
xt = √¯αtx0 + √1 −¯αtϵj
6:
for p = 0, . . . , pi do
7:
ϵj ∼N(0, I)
8:
At =
q
x2
t +
 √1 −¯αtϵj
2
9:
end for
10:
Take gradient descent step on
11:
||x2
t −θ(A2
t)||2
12: until converged
The first five steps are identical to those in DDPM, where Gaussian noise is progressively injected at each sampled
timestep. Afterwards, for each inner iteration p, additional noise ϵj is added to create the noisy magnitude image At.
This step ensures that the model is trained to handle the specific characteristics of Rician noise. In RDDPM, the network
3
θ is trained to predict the squared Gaussian-noise image, x2
t, from the squared Rician-noise image, A2
t, using the mean
square error (MSE) loss.
2.4
Evaluation
In the case of the sodium MRI denoising, Full-Reference Image Quality Assessment (FR-IQA) metrics, such as Peak
Signal-to-Noise Ratio (PSNR) and Structural Similarity (SSIM) [10], are not feasible to evaluate the quality of denoised
sodium MR images due to the absence of high-quality reference images. Therefore, three Non-Reference Image Quality
Assessment (NR-IQA) metrics, Blind/Referenceless Image Spatial Quality Evaluator (BRISQUE) [11], Multi-Scale
Image Quality Transformer (MUSIQ) [12] and From Patches to Pictures (PaQ2PiQ) [13], are used to evaluate the
quality of denoised sodium images. BRISQUE is a commonly used NR-IQA metric while MUSIQ and PaQ2PiQ
have demonstrated substantial agreement with expert evaluations [9]. For comparison, this study also applies one
classic denoising algorithm, BM3D [14], along with three other CNN-based models, DnCNN [15], ResUnet [16] and
ADNet [17], to denoise sodium MR images.
3
Experiments
3.1
Data
This study used data from a cohort of 27 breast cancer patients [18], which was acquired with informed consent and
the approval of the local ethics board. Data of each patient comprised a high-quality T1w MR image and a sodium
MR image. The image intensities are scaled to a range between 0 to 1. Three datasets were built: Synthetic Sodium
Dataset consisting of 270 slices of synthetic sodium MR slices, generated from T1w MR images of nine patients;
Sodium Training Dataset consisting of 540 slices of authentic sodium MR slices from thirteen patients; Sodium
Testing Dataset consisting of 270 slices of authentic sodium MR images from the original nine patients.
3.2
Implementation
All DL models were implemented using Pytorch, trained and tested on an Nvidia A100 GPU. All the CNN denoising
models were trained using the Synthetic Sodium Dataset with batch size of 10, learning rate of 0.001, epoch number of
250, MSE loss and the Adam optimizer. Both DDPM and RDDPM were trained using the denoising results of Unet on
the Sodium Training Dataset, with a learning rate of 0.0002 and the Adam optimizer. DDPM was trained for 1000
epochs. For RDDPM training, maximum diffusion length Tm was set as 40, inner iteration number pi was set as 50.
When testing DDPM and RDDPM on the Sodium Testing Dataset, for simplicity, the start timestep T0 was set as a
fixed value of 15.
4
Results and Discussion
4.1
Denoising Results of DDPM and RDDPM
Figure 2 presents an illustrative example comparing the original sodium MR image with the denoised outputs from
DDPM and RDDPM. Two regions of interest (ROIs), marked by red and green squares, are magnified to improve visual
clarity. A yellow line is also included to highlight the differences in the intensity profiles between the results of DDPM
and RDDPM.
In Figure 2(a), compared to the original sodium MR image, DDPM introduces a higher degree of blurriness, while
RDDPM preserves sharper edges and achieves better feature alignment with the original image. Figure 2(b) demonstrates
that both DDPM and RDDPM perform well in aligning with the original image at high-SNR peaks. However, RDDPM
shows superior performance in denoising low-SNR regions, effectively reducing background noise.
4.2
Comparison of Denoised Results
Figure 3 presents the denoising results of BM3D, DnCNN, Unet, ResUnet, ADNet, DDPM and RDDPM. A ROI is
highlighted by a red square, with a yellow line chosen for comparison. In Figure 3, BM3D demonstrated the poorest
denoising performance, producing a blurred output and losing critical structural details. Both DnCNN and Unet blurred
the image and substantially reduced the ROI’s intensity. ADNet had sharper image quality than the DnCNN and Unet.
From that CNN-based models generally underestimate the intensity of high-SNR peaks.
4
Figure 2: An example of a sodium MR image prior
to DL denoising, and the corresponding denoising
results from DDPM and RDDPM. Two ROIs (a) and
a yellow line (b) are selected and magnified for better
comparison.
Figure 3: An example of a sodium MR image and
the corresponding denoising results from BM3D,
DnCNN, Unet, Resunet, ADNet, DDPM and RD-
DPM. A ROI (a) and a yellow line (b) are selected and
magnified.
Table 1: The image quality evaluation results of denoised sodium MR images. The best and the second-best results are
emphasized in Bold and Italic, respectively.
BRISQUE
MUSIQ
PAQ2PIQ
BM3D
72.4820
5.0743
5.1764
DnCNN
60.9133
4.4017
4.6366
Unet
58.7705
3.7178
4.3825
Resunet
52.7632
3.1747
4.2747
ADNet
40.6889
3.6877
4.4727
DDPM
46.7097
3.4669
4.3865
RDDPM
34.4638
2.7866
4.3806
Table I lists the evaluation results of the denoised images on the Sodium Testing Dataset. The best and the second-best
results are emphasized in Bold and Italic, respectively. RPPDM achieves the best scores in BRISQUE and MUSIQ
evaluations, and the second-best results in PAQ2PIQ, only second to Resunet. These results indicate the superior
performance of RDDPM in denoising sodium MR images compared to other methods.
5
Conclusion
This paper introduces a novel model, Rician DDPM, designed to denoise sodium MR images. Through both qualitative
visual assessments and three quantitative no-reference image metrics, RDDPM demonstrates superior performance
compared to existing CNN-based methods. By addressing the inherent challenges of sodium MRI, RDDPM significantly
improves image quality. When applied in more settings, this RDDPM denoised sodium MRI data may improve the
molecular characterization of patient tumors, which could lead to an improvement in therapeutic strategies.
5
6
Compliance with Ethical Standards
The sodium MRI data used in this paper was obtained with ethical approval (IRAS ID: 260281; West Midlands - Black
Country Research Ethics Committee) and informed consent.
7
Acknowledgements
We acknowledge support from Cancer Research UK (A25922), the Medical Research Council (MR/X018067/1), CRUK
Cambridge Centre and the NIHR Cambridge Biomedical Research Centre (BRC-121520014). This work was performed
using resources provided by the Cambridge Service for Data Driven Discovery (CSD3) operated by the University of
Cambridge Research Computing Service (www.csd3.cam.ac.uk), provided by Dell EMC and Intel using Tier-2 funding
from the Engineering and Physical Sciences Research Council (capital grant EP/T022159/1), and DiRAC funding from
the Science and Technology Facilities Council (www.dirac.ac.uk).
References
[1] Ouwerkerk R, Jacobs MA, Macura KJ, Wolff AC, Stearns V, Mezban SD, Khouri NF, Bluemke DA, Bottomley
PA. Elevated tissue sodium concentration in malignant breast lesions detected with non-invasive 23 Na MRI.
Breast cancer research and treatment.106:151-60. Dec 2007.
[2] Zaric O, Pinker K, Zbyn S, Strasser B, Robinson S, Minarikova L, Gruber S, Farr A, Singer C, Helbich TH,
Trattnig S. Quantitative sodium MR imaging at 7 T: initial results and comparison with diffusion-weighted imaging
in patients with breast tumors. Radiology. 280(1):39-48. Jul 2016.
[3] Madelin G, Lee JS, Regatte RR, Jerschow A. Sodium MRI: methods and applications. Progress in nuclear
magnetic resonance spectroscopy. 79:14-47. May 2014.
[4] Ho J, Jain A, Abbeel P. Denoising diffusion probabilistic models. Advances in neural information processing
systems. 33:6840-51. 2022.
[5] Gong K, Johnson K, El Fakhri G, Li Q, Pan T. PET image denoising based on denoising diffusion probabilistic
model. European Journal of Nuclear Medicine and Molecular Imaging. 51(2):358-68. Jan 2024.
[6] Chung H, Lee ES, Ye JC. MR image denoising and super-resolution using regularized reverse diffusion. IEEE
Transactions on Medical Imaging. 42(4):922-34. Nov 2022.
[7] Xiang T, Yurt M, Syed AB, Setsompop K, Chaudhari A. DDMˆ2: Self-Supervised Diffusion MRI Denoising with
Generative Diffusion Models. arXiv preprint arXiv:2302.03018. Feb 2023.
[8] Ronneberger O, Fischer P, Brox T. U-net: Convolutional networks for biomedical image segmentation. Medical
image computing and computer-assisted intervention–MICCAI 2015: 18th international conference, Springer
International Publishing, Munich, Germany, October 5-9, 2015, proceedings, part III 18 2015 (pp. 234-241).
[9] Yuan S, Whitmarsh T, Kessler DA, Arponen O, McLean MA, Baxter G, Riemer F, Kennerley AJ, Brackenbury
WJ, Gilbert FJ, Kaggie JD. A Deep-Learning-Based Lable-free No-Reference Image Quality Assessment Metric:
Application in Sodium MRI Denoising. arXiv preprint arXiv:2408.16481. Aug 2024.
[10] Wang Z, Bovik AC, Sheikh HR, Simoncelli EP. Image quality assessment: from error visibility to structural
similarity. IEEE transactions on image processing. 13(4):600-12. Apr 2004.
[11] Mittal A, Moorthy AK, Bovik AC. Blind/referenceless image spatial quality evaluator. In 2011 conference record
of the forty fifth asilomar conference on signals, systems and computers (ASILOMAR), IEEE, 2011 Nov 6 (pp.
723-727).
[12] Ke J, Wang Q, Wang Y, Milanfar P, Yang F. Musiq: Multi-scale image quality transformer. In Proceedings of the
IEEE/CVF international conference on computer vision 2021 (pp. 5148-5157).
[13] Ying Z, Niu H, Gupta P, Mahajan D, Ghadiyaram D, Bovik A. From patches to pictures (PaQ-2-PiQ): Mapping the
perceptual space of picture quality. In Proceedings of the IEEE/CVF conference on computer vision and pattern
recognition 2020 (pp. 3575-3585).
[14] Dabov K, Foi A, Katkovnik V, Egiazarian K. Image denoising with block-matching and 3D filtering. In Image
processing: algorithms and systems, neural networks, and machine learning 2006 Feb 17 (Vol. 6064, pp. 354-365).
[15] Zhang K, Zuo W, Chen Y, Meng D, Zhang L. Beyond a gaussian denoiser: Residual learning of deep cnn for
image denoising. IEEE transactions on image processing. 1;26(7):3142-55. Feb 2017.
6
[16] Zhang Z, Liu Q, Wang Y. Road extraction by deep residual u-net. IEEE Geoscience and Remote Sensing Letters.
8;15(5):749-53. Mar 2018.
[17] Tian C, Xu Y, Li Z, Zuo W, Fei L, Liu H. Attention-guided CNN for image denoising. Neural Networks. 1;124:117-
29. Apr 2020.
[18] Kaggie JD, Baxter GC, McLean MA, Woitek R, Gallagher FA, James AD, Kennerley AJ, Schulte RF, Brackenbury
WJ, Gilbert FJ. Sodium Breast Imaging of Ductal Carcinomas at 3 T. ISMRM2022.
7
