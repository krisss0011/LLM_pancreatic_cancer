> REPLACE THIS LINE WITH YOUR PAPER IDENTIFICATION NUMBER (DOUBLE-CLICK HERE TO EDIT) < 
 
1 
  
Abstractâ€”Accurate dose distribution prediction is 
crucial in the radiotherapy planning. Although previous 
methods based on convolutional neural network have 
shown promising performance, they have the problem of 
over-smoothing, leading to prediction without important 
high-frequency details. Recently, diffusion model has 
achieved great success in computer vision, which excels in 
generating images with more high-frequency details, yet 
suffers from time-consuming and extensive computational 
resource consumption. To alleviate these problems, we 
propose Frequency-Decomposed Diffusion Model (FDDM) 
that refines the high-frequency subbands of the dose map. 
To be specific, we design a Coarse Dose Prediction Module 
(CDPM) to first predict a coarse dose map and then utilize 
discrete wavelet transform to decompose the coarse dose 
map into a low-frequency subband and three high-
frequency subbands. There is a notable difference between 
the coarse predicted results and ground truth in high-
frequency subbands. Therefore, we design a diffusion-based 
module 
called 
High-Frequency 
Refinement 
Module 
(HFRM) that performs diffusion operation in the high-
frequency components of the dose map instead of the 
original dose map. Extensive experiments on an in-house 
dataset verify the effectiveness of our approach. 
 
Index 
Termsâ€”Radiotherapy 
Planning, 
Deep 
Learning, 
Diffusion Model, Frequency Decompose 
 
I. INTRODUCTION 
ADIOTHERAPY, as a crucial therapy in cancer treatment,  
 
This work is supported by National Natural Science Foundation of China 
(NSFC 62371325, 62071314), Sichuan Science and Technology Program  
2023YFG0263, 2023YFG0025, 2023NSFSC0497, and Opening Foundation of 
Agile and Intelligent Computing Key Laboratory of Sichuan Province.  
Corresponding author: Yan Wang. 
Xin Liao, Zhenghao Feng, and Yan Wang are with the School of Computer 
Science, Sichuan University, China. (e-mail: liaoxin0528@163.com; 
fzh_scu@163.com;  wangyanscu@hotmail.com). 
Xingchen Peng is with the Department of Biotherapy, Cancer Center, West 
China Hospital, Sichuan University, China. (e-mail: pxx2014@scu.edu.cn). 
Jianghong Xiao is with the Department of Radiation Oncology, Cancer 
Center, West China Hospital, Sichuan University, China. (email: 
xiaojh86@foxmail.com). 
 
 
 
plays a pivotal role in improving patients' survival rates and 
their quality of life. Radiotherapy Planning (RP) is an important 
process, aiming to ensure adequate therapeutic dosage to the 
planning target volume (PTV) while minimizing potential harm 
to the organs at risk (OARs). To obtain a clinically acceptable 
RP, dosimetrists need to manually adjust the optimization 
objectives in a trial-and-error manner. This process is time-
consuming and labor-intensive [1]. Besides, the quality of the 
dose map heavily relies on dosimetristsâ€™ expertise and 
experience [2]. Therefore, it is important to develop methods 
that automatically predict dose distribution maps for patients. 
 Recently, due to the rapid development of deep learning (DL), 
especially the convolutional neural network (CNN), many 
CNN-based dose prediction methods have been proposed [3-8]. 
Kearney et al. [3] proposed a 3D UNet-based model called 
DoseNet to predict the dose distribution map. Nguyen et al. [4] 
employed a modified 2D UNet [9] for dose prediction in 
prostate cancer patients. Wang et al. [5] added a progressive 
refinement module in the UNet (PRUNet) to produce more 
accurate dose distributions. 
 Song et al. [6] utilized the deepLabV3+ [10] to extract 
contextual information from different scales, improving the 
accuracy of dose distribution prediction for patients with 
rectum cancer. Wang et al. [7] disassembled the dose 
distribution into many beam paths to transform the task into 
several easy tasks. Furthermore, following the idea of 
Generative Adversarial Network (GAN), Zhan et al. [8] 
introduced a dual attention module to predict a more precise 
dose map (Mc-GAN).  
 Although these CNN-based methods have achieved 
promising performance, they often suffer from the over-
smoothing problem [11], leading to predictions without 
essential high-frequency details. We display some predicted 
dose maps from five different DL models in Fig. 1, from Fig. 1, 
we can see predictions from (1) to (3) lack high-frequency 
information. These high-frequency details reflect information 
FDDM: Frequency-Decomposed Diffusion 
Model for Rectum Cancer Dose Prediction in 
Radiotherapy 
Xin Liao, Zhenghao Feng, Jianghong Xiao, Xingchen Peng, and Yan Wang, Member, IEEE 
R 
 
Fig. 1. Examples from a rectum cancer patient. (1) to (5) prediction from C3D 
[12], PRUNet, deeplabV3+, DiffDP [13], and FDDM.  
     round  ruth
    FDDM
    DiffDP
    PR-  et
    C D
    deepla    
> REPLACE THIS LINE WITH YOUR PAPER IDENTIFICATION NUMBER (DOUBLE-CLICK HERE TO EDIT) < 
 
2 
on the direction of radiation passing through the human body, 
which is crucial for protecting OARs and killing as many cancer 
cells as possible. In recent years, denoising diffusion 
probabilistic model (DDPM) [14] has achieved good 
performance in various computer vision tasks, Feng et al. [13] 
introduced a structure encoder into the DDPM (DiffDP) to 
better guide the DDPM to generate the dose map. In Fig. 1, we 
find that DDPM is good at generating high-frequency details 
[15], but it requires long running times and substantial 
computational resources to achieve iterative denoising [16]. 
 In this paper, to tackle the problem, we propose the 
Frequency-decomposed Diffusion Model (FDDM) that 
leverages the strength of diffusion models for high-frequency 
details to obtain an accurate dose map and improve the 
efficiency of diffusion models. Specifically, we first gain a 
coarse dose map by our proposed Coarse Dose Prediction 
Module (CDPM). Then, we decompose the coarse dose map 
into four subbands with three high-frequency subbands and a 
low-frequency subband by discrete wavelet transform (DWT), 
which significantly reduces the spatial dimension without 
compromising information [17]. Accordingly, we propose a 
High-Frequency Refinement Module (HFRM) that performs 
diffusion operation in high-frequency subbands rather than the 
original dose map, resulting in a faster speed compared to the 
previous diffusion-based method, DDPM. Furthermore, to 
better guide HFRM to generate the high-frequency components 
of the dose map, we condition HFRM at both the image level 
and feature level. Finally, we use inverse wavelet transform 
(IWT) for dose map reconstruction. Our contributions to this 
work can be summarized as follows: 1) we propose a dose 
prediction framework called Frequency-decomposed Diffusion 
Model (FDDM) for rectum cancer patients, which harnesses the 
generative ability of diffusion models on high-frequency details 
and the strengths of the discrete wavelet transform (DWT) for 
more precise and efficient dose prediction. 2) we design a 
Coarse Dose Prediction Module (CDPM) to generate the coarse 
map and a High-Frequency Refinement Module (HFRM) that 
performs diffusion operation in the wavelet domain to refine the 
high-frequency components of the dose map. 3) we conduct 
substantial experiments on an in-house dataset comprising 130 
rectum cancer patients, demonstrating the outstanding 
performance of our proposed method. 
 
II. METHODS 
An overview of the proposed FDDM model is illustrated in 
Fig. 2, we first produce a coarse dose map by Coarse Dose 
Prediction Module (CDPM) and do discrete wavelet transform 
(DWT) to resolve the coarse prediction into three high-
frequency subbands and a low-frequency subband. Then we 
introduce a High-Frequency Refinement Module (HFRM) to 
generate refined high-frequency components. Finally, we 
utilize inverse wavelet transformation (IWT) to reconstruct the 
predicted dose map. 
A. Coarse Dose Prediction Module 
To make the predicted dose map encompass as rich 
information as the ground truth, we propose a Coarse Dose 
Prediction Module (CDPM), shown in Fig. 2(a). CDPM takes 
X as input and outputs a coarse dose map ð‘ŒÌ‚, where X includes 
the original CT images and the segmentation masks of the PTV  
and OARs. Encouraged by the great success of UNet [10], we 
utilize a six-level UNet to construct CDPM. Specifically, the 
encoder involves five modules, where each module contains a 
Residual Block (ResBlock) and a Downsampling block, except 
for the final one. The ResBlock includes two convolutional 
blocks (ConvBlock), each containing a 3 Ã— 3 convolutional 
(Conv) layer, a GroupNorm (GN) layer, and a Swish activation 
function. To address the problem of gradient vanishing during 
training, we introduce residual connections. Furthermore, the 
Downsampling block consists of a 3 Ã— 3 Convolutional layer 
with a stride of 2, allowing for effective downsampling of the 
feature maps. The decoder includes five deconvolution blocks 
to upsample, where each block comprises an Upsampling block 
and two Resblocks with the last one excluding the Upsampling 
block, and each Upsampling block utilizes the Nearest neighbor 
up-sampling and a Conv layer with a kernel size of 1 to 
implement 
the upsampling 
operation. 
Additionally, 
a 
bottleneck is incorporated between the encoder and decoder, 
which consists of two ResBlocks and a self-attention module. 
The skip connections are utilized to enable multi-level feature 
reuse and aggregation between the encoder and decoder. During 
training, we use L1 loss to minimize the content difference 
between the coarse prediction ð‘ŒÌ‚ and ground truth ð‘Œ: 
ð¿ð¶ð·ð‘ƒð‘€= |ð‘ŒÌ‚ âˆ’ð‘Œ|.
(1) 
B. Wavelet Frequency Decomposition 
The output of the CDPM is a coarse prediction, which is 
blurred with a few high-frequency details. To solve this 
problem, we refine the high-frequency subbands of the coarse 
dose map. Specifically, we use 2D discrete wavelet 
transformation (DWT) with Haar wavelets [18] to decompose 
the coarse dose map ð‘ŒÌ‚ âˆˆð‘…ð»Ã—ð‘Š into four high- and low-
frequency subbands, illustrated in Fig. 2(b). This process can be 
formulated as: 
ð·ð‘Šð‘‡(ð‘ŒÌ‚) = {ð‘ŒÌ‚ð¿ð»,ð‘ŒÌ‚ð»ð¿, ð‘ŒÌ‚ð»ð»,ð‘ŒÌ‚ð¿ð¿},
(2) 
where 
ð‘ŒÌ‚ð¿ð», ð‘ŒÌ‚ð»ð¿, ð‘ŒÌ‚ð»ð», ð‘ŒÌ‚ð¿ð¿âˆˆð‘…
ð»
2Ã—
ð‘Š
2
, 
ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž= {ð‘ŒÌ‚ð¿ð», ð‘ŒÌ‚ð»ð¿, ð‘ŒÌ‚ð»ð»} 
represents the high-frequency subbands of the dose map, which 
contains the edge and detail information, and ð‘ŒÌ‚ð‘™ð‘œð‘¤= {ð‘ŒÌ‚ð¿ð¿} is 
the low-frequency subband of the dose map, encompassing the 
overall structural information. 
 
Fig.  . Overview of the proposed FDDM network. â€˜DW â€™ in     and â€˜IW â€™ in 
(d) represent discrete wavelet transform and inverse wavelet transform, 
respectively. 
CT, OARs, PTV ( )
ð‘ŒÌ‚
DWT
ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž
ð‘ŒÌ‚ð‘™ð‘œð‘¤
  (ð‘Œ â„Žð‘–ð‘”â„Ž
    ð‘Œ â„Žð‘–ð‘”â„Ž
 
,ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž)
â€¦
â€¦
ð‘Œ â„Žð‘–ð‘”â„Ž
 
ð‘Œ â„Žð‘–ð‘”â„Ž
 
ð‘Œ â„Žð‘–ð‘”â„Ž
   
ð‘Œ â„Žð‘–ð‘”â„Ž
 
â€¦
â€¦
 (ð‘Œâ„Žð‘–ð‘”â„Ž
 
 ð‘Œâ„Žð‘–ð‘”â„Ž
   )
(a) Coarse Dose Prediction Module
ï¼ˆc) High-Frequency Refinement Module
(b) Wavelet frequency decomposition
ï¼ˆd) dose map reconstruction
IWT
ð‘Œ 
C
ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž
C
Concatenation
Forward process
Reversed process
Element addition
Cross attention
> REPLACE THIS LINE WITH YOUR PAPER IDENTIFICATION NUMBER (DOUBLE-CLICK HERE TO EDIT) < 
 
3 
C. High-Frequency Refinement Module 
The coarse prediction is over-smoothed without many high-
frequency details, leading to significant differences compared 
to the ground truth on high-frequency subbands. To generate a 
dose map with more details, we propose High-Frequency 
Refinement Modules (HFRM), shown in Fig. 2(c). Our 
proposed HFRM is based on the Denoising Diffusion 
Probabilistic Model (DDPM) [14], which consists of two 
processes: the forward and the reverse process. Different from 
traditional DDPM, we conduct diffusion operations in the 
wavelet domain instead of the image space, which allows for 
accelerated inference speed. Consequently, the forward process 
in HFRM first pred-defines a variance schedule {ð›½ , ð›½2, â€¦ , ð›½ } 
to progressively transform high-frequency components of the 
dose map ð‘Œâ„Žð‘–ð‘”â„Ž
 
 to a noisy data ð‘Œâ„Žð‘–ð‘”â„Ž
 
 ~ ð’©(0, ð¼) through T steps: 
ð‘ž(ð‘Œâ„Žð‘–ð‘”â„Ž
 
|ð‘Œâ„Žð‘–ð‘”â„Ž
   ) = ð’©(ð‘Œâ„Žð‘–ð‘”â„Ž
 
;âˆš1 âˆ’ð›½ ð‘Œâ„Žð‘–ð‘”â„Ž
   , ð›½ ð¼).
(3) 
Besides, based on the property of the Markov Chain, we can 
directly get ð‘Œâ„Žð‘–ð‘”â„Ž
 
 at any intermediate timestep t from ð‘¥  
through the formula: 
ð‘ž(ð‘Œâ„Žð‘–ð‘”â„Ž
 
|ð‘Œâ„Žð‘–ð‘”â„Ž
 
) = ð’©(ð‘Œâ„Žð‘–ð‘”â„Ž
 
; âˆšð›¼Ì… ð‘Œâ„Žð‘–ð‘”â„Ž
 
, (1 âˆ’ð›¼Ì… )ð¼) 
                = âˆšð›¼Ì… ð‘Œâ„Žð‘–ð‘”â„Ž
 
+ (1 âˆ’ð›¼Ì… )ðœ– ,
(4) 
where ð›¼Ì… â‰”âˆ
(1 âˆ’ð›½ð‘–)
 
ð‘–= 
, ðœ–ð‘¡~ð’©(0, ð¼). 
In the reverse phase, the HFRM generates images by 
denoising a randomly sampled standard Gaussian noise 
ð‘Œ â„Žð‘–ð‘”â„Ž
 
 ~ ð’©(0, ð¼) into clear high-frequency subbands ð‘Œ â„Žð‘–ð‘”â„Ž
 
, the 
process is also a Gaussian transition. In a classical diffusion 
model, this process is usually conditioned in the image level, 
namely simply concatenating the struct image as an image prior. 
However, the reverse process beginning with a sampled 
randomly Gaussian noise may suffer from a content 
inconsistency between the predicted results and ground truth 
owing to the diversity of the sampling process. Therefore, we 
employ conditions in both the image and feature levels: 
ð‘ (ð‘Œ â„Žð‘–ð‘”â„Ž
   | ð‘Œ â„Žð‘–ð‘”â„Ž
 
) = ð’©( ð‘Œ â„Žð‘–ð‘”â„Ž
   ; ðœ‡ (ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž,  , ð‘Œ â„Žð‘–ð‘”â„Ž
 
, ð‘¡), ðœŽ 
2ð¼),
(5) 
where ðœŽ 
2 is usually a fixed variable related to ð›½ , and ð‘Œ â„Žð‘–ð‘”â„Ž
 
 are 
high-frequency components of coarse prediction, and 
ðœ‡ (ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž,  , ð‘Œ â„Žð‘–ð‘”â„Ž
 
, ð‘¡) is usually predicted by a denoising UNet 
ðœ– (ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž,  , ð‘Œ â„Žð‘–ð‘”â„Ž
 
, ð‘¡): 
ðœ‡ (ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž,  , ð‘Œ â„Žð‘–ð‘”â„Ž
 
, ð‘¡) =
1
âˆšð›¼ 
(ð‘Œ â„Žð‘–ð‘”â„Ž
 
âˆ’1 âˆ’ð›¼ 
âˆš1 âˆ’ð›¼Ì… 
ðœ– (ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž,  , ð‘Œ â„Žð‘–ð‘”â„Ž
 
, ð‘¡)) .
(6) 
The UNet architecture in our proposed HFRM shares the 
same structure as the CDPM.  At the image level, we 
concatenate 
high-frequency 
components 
ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž
 and 
intermediate result ð‘Œ â„Žð‘–ð‘”â„Ž
 
 as input. For the feature level, feature 
maps of CDPM are element-wise added at the first two encoder 
modules, while in the following three encoder modules, we 
apply a cross-attention operation to gain similarity-based 
structure guidance at deeper levels. 
The main goal is to optimize the denoising model ðœ–  to 
achieve a close approximation between the predicted noise 
ðœ– (ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž,  , ð‘Œ â„Žð‘–ð‘”â„Ž
 
, ð‘¡) in the reverse process and added noise ðœ–  
in the forward process, the training objective can be formulated 
as: 
ð¿ð»ð¹ð‘…ð‘€= ð¸ð‘Œâ„Žð‘–ð‘”â„Ž
0
, ,ðœ–ð‘¡~ð’©( ,ð¼)[|ðœ– âˆ’ðœ– (ð‘ŒÌ‚â„Žð‘–ð‘”â„Ž,  , ð‘Œ â„Žð‘–ð‘”â„Ž
 
, ð‘¡)|].
(7) 
D. Dose Map Reconstruction 
After gaining refined high-frequency subbands, we utilize 
IWT on the refined high-frequency subbands and the low-
frequency subband of the coarse dose map to reconstruct the 
dose map. This process is shown in Fig. 2(d) and can be 
formulated as: 
ð‘¦Ìƒ = ð¼ð‘Šð‘‡(ð‘Œ â„Žð‘–ð‘”â„Ž
 
, ð‘ŒÌ‚ð‘™ð‘œð‘¤).
(8) 
The whole model is constructed in an end-to-end mode and the 
total loss ð¿ ð‘œ ð‘Žð‘™ can be formulated as the sum of (1) and (7): 
ð¿ ð‘œ ð‘Žð‘™= ð¿ð¶ð·ð‘ƒð‘€+ ð¿ð»ð¹ð‘…ð‘€.
(9) 
 
III. EXPERIMENTS 
A. Dataset and Evaluation Metrics 
To evaluate the performance of our proposed method, we 
conduct extensive experiments on a dataset curated from an in-
house rectum cancer dataset at West China Hospital. It contains 
130 patients who underwent volumetric modulated arc therapy 
(VMAT) treatment. Every patient contains CT images, OAR 
segmentations, PTV segmentation, and clinically planned dose 
distribution. In addition, OAR segmentations include the small 
intestine (ST), FemoralHeadL(FHL), FemoralHeadR (FHR), 
and bladder (BLD). We randomly select 98, 10, and 22 patients 
for training, validation, and testing, respectively. Before 
training, we split the 3D volumes with a resolution of 
3mmÃ—3mmÃ—3mm into multiple 2D slices with a size of 160 Ã— 
160 along the axial direction. Finally, we obtained 16346 slices 
for training, 1529 slices for validation, and 3491 slices for 
testing. 
We select multiple metrics for the evaluation of our proposed 
model. We employ ð·2, ð·5 , mean dose ( ð·ð‘šð‘’ð‘Žð‘›), and 
conformity index (CI) [19] for evaluation. Here Dm denotes the 
lowest dose absorbed that encompasses a volume percentage of 
m% of the PTV. CI is defined as: 
ð¶ð¼=
(ð‘‰ð‘ƒ ð‘‰âˆ©ð‘‰   %ð¼ð‘†ð‘‚)2
ð‘‰ð‘ƒ ð‘‰Ã— ð‘‰   %ð¼ð‘†ð‘‚
,
(10) 
where ð‘‰ð‘ƒ ð‘‰ represents the volume of the PTV, and ð‘‰   %ð¼ð‘†ð‘‚ 
indicates the isodose volume, which is a binary mask that is 
assigned a value of 1 when the dose value of a voxel exceeds 
the threshold value, and 0 otherwise. We calculate the 
difference (âˆ†) of these metrics between the predicted results 
and ground truth. Furthermore, we employ the dose volume 
histogram (DVH) [20] as an intuitive metric for comparison. 
TABLE I 
       QUANTITATIVE COMPARISON RESULTS WITH STATE-OF-THE-ART 
 METHODS ON PTV 
Methods 
 âˆ†ð¶ð¼  
 âˆ†ð·2 (Gy) 
 âˆ†ð·5  (Gy) 
 âˆ†ð·ð‘šð‘’ð‘Žð‘› (Gy) 
UNet [4] 
0.131(0.136) 
1.043(0.383) 2.221(1.468) 
2.077(1.352) 
U-ResNet-D 
[21] 
0.0868(0.127) 1.043(0.383) 2.556(1.684) 
2.416(1.504) 
deepLabV3+ 
[6] 
0.0650(0.142) 0.547(0.462) 0.975(1.593) 
0.968(1.450) 
C3D [12] 
0.0635(0.144) 0.561(0.476) 0.801(1.388) 
0.856(1.185) 
PRUNet [5] 
0.0651(0.136) 0.754(0.422) 0.914(1.638) 
0.959(1.465) 
Mc-GAN 
[8] 
0.0827(0.150) 1.004(0.458) 1.273(1.215) 
1.268(1.049) 
DiffDP [13] 
0.0683(0.131) 0.486(0.350) 0.776(1.353) 
0.780(1.180) 
Proposed 
0.0626(0.137) 0.309(0.192) 0.754(1.484) 
0.762(1.308) 
 
 
> REPLACE THIS LINE WITH YOUR PAPER IDENTIFICATION NUMBER (DOUBLE-CLICK HERE TO EDIT) < 
 
4 
When DVH curves of the ground truth and predictions are 
closer, we can infer better prediction results. 
B. Implementation Details 
Our proposed method is implemented with the PyTorch 
framework on an NVIDIA RTX 3090 GPU with 24 GB 
memory.  We use the Adam as optimizer to train the model for 
  00 epochs with a learning rate of  eâˆ’  and a  atch size of   . 
Additionally, the time step number of diffusion model T is set 
to 1000 during training. 
C. Comparison with State-Of-The-Art Methods  
We compare the performance of the proposed method to the 
state-of-the-art (SOTA) methods, including UNet [4], U-
ResNet-D [21], deepLabV3+ [6], C3D [12], PRUNet [5], Mc-
GAN [8], and DiffDP [13] for comparison. The quantitative 
comparison results are listed in Table. 1, illustrating the 
superiority of our method over existing SOTA models in all 
metrics. Specifically, compared with DiffDP with the second-
best accuracy in  âˆ†ð·5   (0.776 Gy) and  âˆ†ð·ð‘šð‘’ð‘Žð‘›  (0.780 Gy), 
the results generated by the proposed are 0.022 and 0.018 lower, 
respectively. As for  âˆ†ð·2 , method outperforms the second-best 
approach by a margin of 0.309 Gy. Furthermore, we also 
display some quantitative results on  âˆ†ð·2  of OARs in Fig. 3, 
which demonstrates our proposed method achieves the best 
performance on the OARs. Besides, we also present the DVH 
curves in Fig. 4. Compared with other methods, the disparity 
between the DVH curves of our method and the ground truth is 
the smallest, especially for ST and BLD, demonstrating the 
superior performance of the proposed. Furthermore, we 
visualize the prediction results in Fig.5. As we can see, the dose 
map generated by our proposed method contains more high-
frequency details. Besides, the error map of our proposed 
method appears to be the darkest, indicating the least disparity 
when compared to the ground truth. 
D. Ablation Study 
To verify the effectiveness of pivotal components in our 
proposed method, we conduct a series of ablation experiments. 
The experiment arrangement can be generally concluded as (A) 
only CDPM, (B) only HFRM (use HFRM to directly predict the 
dose map), (C) we use a CDPM to generate a coarse dose map 
and use another CDPM to refine the high-frequency subbands, 
and (D) CDPM+HFRM (the proposed method). we compare the 
experimental results between (B) and (D), compared to (B), (D) 
exhibits a substantial improvement in all four metrics. 
Particularly, in terms of CI, in which (D) outperforms (B) by a 
margin of 0.495, demonstrating its effectiveness. 
The Experimental results are given in Table 2. We can compare 
the results of (A) and (D), after adding HFRM, âˆ†ð¶ð¼, âˆ†ð·2, âˆ†ð·5 , 
and âˆ†ð·ð‘šð‘’ð‘Žð‘› improve a lot with 0.0179, 0.577 Gy, 0.159 Gy, 
and 0.149 Gy, respectively. Besides, we can see that (D) 
outperforms (C) in all metrics, illustrating the generality ability 
of high-frequency details of the HFRM. 
 
IV. CONCLUSION  
In this paper, we present Frequency-Decomposed Diffusion 
Model (FDDM) for robust and efficient rectum cancer dose 
prediction in radiotherapy. Technically, we design a Coarse 
Dose Prediction Module (CDPM) to gain a coarse dose map. 
Besides, we proposed a High-Frequency Refinement Module 
(HFRM) that conducts the diffusion process in the wavelet 
space rather than the image space to generate a more accurate 
dose map. Moreover, we condition our proposed HFRM in both 
the image and feature level for better guidance. The 
experimental results demonstrate that our method significantly 
outperforms other methods. 
 
REFERENCES 
 
[1] Y. Murakami, et al., "Possibility of chest wall dose reduction using 
volumetric-modulated arc therapy (VMAT) in radiation-induced rib 
fracture cases: comparison with stereotactic body radiation therapy 
(SBRT)," J. Radiat. Res., vol. 59, no. 3, pp. 327â€“332, 2018. 
 
Fig. 3. Quantitative results of SOTA methods on OARs (i.e., ST, FHL, FHR, 
and BLD) in terms of  âˆ†ð·2 . 
 
 
Fig. 4. DVH curves for comparison with SOTA methods. The solid line 
denotes the ground truth while the dotted line denotes the predictions. 
 
 
Fig. 5. Visualization of the proposed method and SOTA methods. The first 
row visualizes the predicted dose maps and the the second row represents the 
error heat maps. 
 
2.39
2.61
0.983
0.882
1.231
1.168
1.139
0.805
0
2
4
(a)
ST
6.476
6.525
4.046
4
3.872
3.573
3.714
3.669
0
5
10
(b)
FHL
5
4.309
4.211
4.988
4.313
4.135
3.995
3.678
0
2
4
6
(c)
FHR
1.958
1.928
1.146
1.089
1.054
1.295
0.903
0.759
0
1
2
3
(d)
BLD
    
          
           
   
      
      
      
        
DiffDP
McGAN
Proposed
PRUNet
C3D
Ground Truth
Proposed
DiffDP
Mc-GAN
PRUNet
C3D
TABLE II 
ABLATION STUDY OF OUR METHOD ON PTV IN TERMS OF âˆ†ð¶ð¼, âˆ†ð·2, âˆ†ð·5 , 
AND âˆ†ð·ð‘šð‘’ð‘Žð‘› 
 
 âˆ†ð¶ð¼  
 âˆ†ð·2 (Gy) 
 âˆ†ð·5  (Gy) 
 âˆ†ð·ð‘šð‘’ð‘Žð‘› (Gy) 
(A) 
0.0805(0.142) 
0.886(0.408) 
0.913(1.383) 
0.911(1.224) 
(B) 
0.0637(0.125) 
0.804(0.385) 
0.855(1.505) 
0.909(1.351) 
(C) 
0.0659(0.141) 
0.490(0.266) 
0.810(1.531) 
0.831(1.366) 
(D) 
0.0626(0.137) 
0.309(0.192) 
0.754(1.484) 
0.762(1.308) 
 
 
> REPLACE THIS LINE WITH YOUR PAPER IDENTIFICATION NUMBER (DOUBLE-CLICK HERE TO EDIT) < 
 
5 
[2] B. E. Nelms, G. Robinson, J. Markham, K. Velasco, S. Boyd, S. Narayan, 
and M. L. Sobczak, "Variation in external beam treatment plan quality: 
an inter-institutional study of planners and planning systems," Practical 
Radiat. Oncol., vol. 2, no. 4, pp. 296-305, 2012. 
[3] V. Kearney, J. W. Chan, S. Haaf, M. Descovich, and T. D. Solberg, 
"DoseNet: a volumetric dose prediction algorithm using 3D fully-
convolutional neural networks," Phys. Med. Biol., vol. 63, no. 23, 235022, 
2018. 
[4] D. Nguyen, T. Long, X. Jia, W. Lu, X. Gu, Z. Iqbal, and S. Jiang, "Dose 
prediction with U-net: a feasibility study for predicting dose distributions 
from contours using deep learning on prostate IMRT patients," arXiv 
preprint arXiv:1709.09233, 2017. 
[5] J. Wang, J. Hu, Y. Song, Q. Wang, X. Zhang, S. Bai, and Z. Yi, "VMAT 
dose prediction in radiotherapy by using progressive refinement UNet," 
Neurocomputing, vol. 488, pp. 528-539, 2022. 
[6] Y. Song, J. Hu, Y. Liu, H. Hu, Y. Huang, S. Bai, and Z. Yi, "Dose 
prediction using a deep neural network for accelerated planning of rectal 
cancer radiotherapy," Radiother. Oncol., vol. 149, pp. 111-116, 2020. 
[7] B. Wang, L. Teng, L. Mei, Z. Cui, X. Xu, Q. Feng, and D. Shen, "Deep 
learning-based head and neck radiotherapy planning dose prediction via 
beam-wise dose decomposition," in Proc. Int. Conf. Med. Image Comput. 
Comput.-Assist. Intervent. (MICCAI), Cham, Switzerland, 2022, pp. 
575-584. 
[8] B. Zhan, J. Xiao, C. Cao, X. Peng, C. Zu, J. Zhou, and Y. Wang, "Multi-
constraint generative adversarial network for dose prediction in 
radiotherapy," Med. Image Anal., vol. 77, 102339, 2022. 
[9] O. Ronneberger, P. Fischer, and T. Brox, "U-net: Convolutional networks 
for biomedical image segmentation," in Proc. Int. Conf. Med. Image 
Comput. Comput.-Assist. Intervent. (MICCAI), Munich, Germany, 2015, 
pp. 234-241. 
[10] L. C. Chen, Y. Zhu, G. Papandreou, F. Schroff, and H. Adam, "Encoder-
decoder with atrous separable convolution for semantic image 
segmentation," in Proc. Eur. Conf. Comput. Vision (ECCV), 2018, pp. 
801-818. 
[11] C. Chen, X. Chen, and H. Cheng, "On the over-smoothing problem of 
CNN based disparity estimation," in Proc. IEEE/CVF Int. Conf. Comput. 
Vision, 2019, pp. 8997-9005. 
[12] S. Liu, J. Zhang, T. Li, H. Yan, and J. Liu, "A cascade 3D U-net for dose 
prediction in radiotherapy," Med. Phys., vol. 48, no. 9, pp. 5574-5582, 
2021. 
[13] Z. Feng, L. Wen, P. Wang, B. Yan, X. Wu, J. Zhou, and Y. Wang, 
"DiffDP: Radiotherapy dose prediction via a diffusion model," in Proc. 
Int. Conf. Med. Image Comput. Comput.-Assist. Intervent. (MICCAI), 
Cham, Switzerland, 2023, pp. 191-201. 
[14] J. Ho, A. Jain, and P. Abbeel, "Denoising diffusion probabilistic models," 
Adv. Neural Inf. Process. Syst., vol. 33, pp. 6840-6851, 2020. 
[15] X. Yang, D. Zhou, J. Feng, and X. Wang, "Diffusion probabilistic model 
made slim," in Proc. IEEE/CVF Conf. Comput. Vision Pattern Recognit., 
2023, pp. 22552-22562. 
[16] H. Jiang, A. Luo, H. Fan, S. Han, and S. Liu, "Low-light image 
enhancement with wavelet-based diffusion models," ACM Trans. Graph., 
vol. 42, no. 6, pp. 1-14, 2023. 
[17] H. Phung, Q. Dao, and A. Tran, "Wavelet diffusion models are fast and 
scalable image generators," in Proc. IEEE/CVF Conf. Comput. Vision 
Pattern Recognit., 2023, pp. 10199-10208. 
[18] A. Haar, "Zur theorie der orthogonalen funktionensysteme," Math. Ann., 
vol. 71, no. 1, pp. 38â€“53, 1911. 
[19] I. Paddick, "A simple scoring ratio to index the conformity of 
radiosurgical treatment plans," J. Neurosurg., vol. 93, no. supplement 3, 
pp. 219-222, 2000. 
[20] M. V. Graham, et al., "Clinical doseâ€“volume histogram analysis for 
pneumonitis after 3D treatment for non-small cell lung cancer (NSCLC)," 
Int. J. Radiat. Oncol. Biol. Phys., vol. 45, no. 2, pp. 323-329, 1999. 
[21] Z. Liu, J. Fan, M. Li, H. Yan, Z. Hu, P. Huang, and J. Dai, "A deep 
learning method for prediction of three-dimensional dose distribution of 
helical tomotherapy," Med. Phys., vol. 46, no. 5, pp. 1972-1983, 2019. 
 
